<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.smartGrade.student.StudentMapper">
    <insert id="insSdy" useGeneratedKeys="true" keyProperty="ilectureStudent">
        INSERT INTO lecture_student (istudent, ilecture, finished_yn)
        SELECT s.istudent, la.ilecture, 0 as finishedYn
        FROM student s, lecture_applly la
        WHERE s.istudent = #{istudent}
        AND la.ilecture = #{ilecture}
    </insert>

    <select id="selDayWeek">
        select day_week dayWeek
        from lecture_day_week
        where ilecture = #{ilecture}
    </select>


    <select id="selAllSdy">
        SELECT A.istudent ,D.student_num studentNum,D.grade,B.ilecture_name ilectureName,C.lecture_name
        lectureName,B.iprofessor
        ,C.score,A.attendance,A.midterm_examination midtermExamination
        ,A.final_examination finalExamination,A.total_score totalScore,A.finished_yn finishedYn
        FROM lecture_student A
        INNER JOIN lecture_applly B
        ON A.ilecture = B.ilecture
        INNER JOIN lecture_name C
        ON B.ilecture_name = C.ilecture_name
        INNER JOIN student D
        ON A.istudent = D.istudent
        WHERE A.istudent = #{istudent} and A.finished_yn = 1
    </select>

    <select id="StudentCount">
        SELECT COUNT(*)
        FROM student
        WHERE student_num = #{studentNum}
    </select>

    <select id="selStudentProfile">
        SELECT A.istudent,D.student_num studentNum
        ,D.imajor,D.grade,D.nm,
        D.gender,D.pic,D.birthdate,D.phone,D.email,D.address,D.finished_yn finishedYn,sum(C.score) score
        FROM lecture_student A
        INNER JOIN lecture_applly B
        ON A.ilecture = B.ilecture
        INNER JOIN lecture_name C
        ON B.ilecture_name = C.ilecture_name
        INNER JOIN student D
        ON A.istudent = D.istudent
        WHERE D.istudent = #{istudent} AND A.finished_yn = 1
    </select>

    <select id="selStudentRemainingPoint">
        SELECT A.istudent,D.student_num studentNum
        ,D.imajor,D.grade,D.nm,
        D.gender,D.finished_yn finishedYn,sum(C.score) score,E.graduation_score graduationScore,
        E.graduation_score-sum(C.score) remainingPoints
        FROM lecture_student A
        INNER JOIN lecture_applly B
        ON A.ilecture = B.ilecture
        INNER JOIN lecture_name C
        ON B.ilecture_name = C.ilecture_name
        INNER JOIN student D
        ON A.istudent = D.istudent
        INNER JOIN major E
        ON D.imajor = E.imajor
        WHERE A.istudent = #{istudent} AND A.finished_yn = 1
        LIMIT #{startIdx}, #{row}
    </select>
    <update id="upStudent">

        update student
        set
        pic = #{pic},
        phone = #{phone},
        email = #{email},
        address = #{address},
        updated_at = current_timestamp
        where istudent = #{istudent}
    </update>

    <update id="updPassword">
        UPDATE student
        SET student_password = #{studentPassword}
        WHERE istudent = #{istudent} AND role = #{role}
    </update>

    <select id="selPasswordCurrent">
        SELECT istudent, role, student_num id,
        student_password currentStudentPassword
        FROM student
        WHERE istudent = #{istudent} AND role = #{role}
    </select>

    <select id="picFilePathByStudent">
        SELECT pic
        FROM student
        WHERE istudent = #{istudent}
    </select>

    <update id="updateFilePathNullByStudent">
        UPDATE student
        SET pic = NULL
        WHERE istudent = #{istudent}
    </update>

</mapper>